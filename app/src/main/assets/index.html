<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Physio SUAI – By SULLIVAN</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#ec4899">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="PhysioSUAI">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js').then(function(reg) {
          console.log('SW registered ✅', reg.scope);
        }).catch(function(err) {
          console.log('SW registration failed:', err);
        });
      });
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- 1️⃣  Firebase CDN – MUST load before any firebase.xxx call -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <!-- 2️⃣  Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    @keyframes fadeUp  { from{opacity:0;transform:translateY(28px)} to{opacity:1;transform:translateY(0)} }
    @keyframes pulse2  { 0%,100%{transform:scale(1)} 50%{transform:scale(1.08)} }
    .anim-up   { animation: fadeUp  .7s ease-out both }
    .anim-pulse{ animation: pulse2 2s   ease-in-out infinite }
    .grad-text {
      background: linear-gradient(135deg,#ec4899,#8b5cf6);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .glass {
      background: rgba(17,24,39,.88);
      backdrop-filter: blur(14px);
      border: 1px solid rgba(255,255,255,.07);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 min-h-screen text-white overflow-x-hidden">

  <!-- INTRO -->
  <div id="intro" class="fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-purple-900 via-pink-900 to-gray-900">
    <div class="text-center space-y-8 anim-up">
      <div class="relative">
        <div class="absolute inset-0 bg-pink-500 rounded-full blur-3xl opacity-40 anim-pulse"></div>
        <h1 class="text-7xl font-black grad-text relative z-10">Physio SUAI</h1>
      </div>
      <p class="text-3xl text-pink-300 anim-up" style="animation-delay:.3s">By SULLIVAN</p>
      <div class="flex justify-center gap-2 anim-up" style="animation-delay:.6s">
        <span class="w-3 h-3 bg-pink-500   rounded-full anim-pulse inline-block"></span>
        <span class="w-3 h-3 bg-purple-400 rounded-full anim-pulse inline-block" style="animation-delay:.2s"></span>
        <span class="w-3 h-3 bg-blue-400   rounded-full anim-pulse inline-block" style="animation-delay:.4s"></span>
      </div>
    </div>
  </div>

  <!-- LOGIN -->
  <div id="loginBox" class="hidden min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full glass rounded-3xl p-8 shadow-2xl anim-up">
      <div class="text-center mb-8">
        <h2 class="text-4xl font-black grad-text mb-1">Welcome Back</h2>
        <p class="text-gray-400 text-sm">Login to continue your journey</p>
      </div>
      <div class="space-y-5">
        <input type="email"    id="lEmail" placeholder="Email"
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-pink-500 transition text-white placeholder-gray-500">
        <input type="password" id="lPass"  placeholder="Password"
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-pink-500 transition text-white placeholder-gray-500">
        <button onclick="doLogin()"
          class="w-full bg-gradient-to-r from-pink-500 to-purple-600 hover:opacity-90 font-bold py-4 rounded-xl transition transform active:scale-95 shadow-lg text-white">
          Login
        </button>
        <div id="loginErr" class="hidden text-red-400 text-sm text-center font-medium"></div>
      </div>
      <p class="text-center text-gray-400 mt-6 text-sm">No account?
        <button onclick="showSignup()" class="text-pink-400 font-semibold ml-1">Sign Up</button>
      </p>
    </div>
  </div>

  <!-- SIGNUP -->
  <div id="signupBox" class="hidden min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full glass rounded-3xl p-8 shadow-2xl anim-up">
      <div class="text-center mb-8">
        <h2 class="text-4xl font-black grad-text mb-1">Create Account</h2>
        <p class="text-gray-400 text-sm">Join the Physio SUAI community</p>
      </div>
      <div class="space-y-5">
        <input type="text"     id="sName"  placeholder="Full Name"
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-pink-500 transition text-white placeholder-gray-500">
        <input type="email"    id="sEmail" placeholder="Email"
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-pink-500 transition text-white placeholder-gray-500">
        <input type="password" id="sPass"  placeholder="Password (min 6 characters)"
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-pink-500 transition text-white placeholder-gray-500">
        <input type="password" id="sPass2" placeholder="Confirm Password"
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-pink-500 transition text-white placeholder-gray-500">
        <button onclick="doSignup()"
          class="w-full bg-gradient-to-r from-pink-500 to-purple-600 hover:opacity-90 font-bold py-4 rounded-xl transition transform active:scale-95 shadow-lg text-white">
          Sign Up
        </button>
        <div id="signupErr" class="hidden text-red-400 text-sm text-center font-medium"></div>
      </div>
      <p class="text-center text-gray-400 mt-6 text-sm">Already have an account?
        <button onclick="showLogin()" class="text-pink-400 font-semibold ml-1">Login</button>
      </p>
    </div>
  </div>

  <!-- LOADING SPINNER -->
  <div id="spinner" class="hidden fixed inset-0 z-[9999] bg-black/75 backdrop-blur-sm flex items-center justify-center">
    <div class="text-center space-y-4">
      <div class="w-16 h-16 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto"></div>
      <p id="spinMsg" class="text-white font-semibold">Please wait…</p>
    </div>
  </div>

  <!-- 3️⃣  App logic – INLINE so there are zero file-loading race conditions -->
  <script>
    // ── Firebase init (firebase CDN already loaded above) ────────
    var FIREBASE_CONFIG = {
      apiKey:            "AIzaSyA8YSCRPDDOO1aiVXdhdwBbVsosmyktZZk",
      authDomain:        "physio-suai.firebaseapp.com",
      databaseURL:       "https://physio-suai-default-rtdb.firebaseio.com",
      projectId:         "physio-suai",
      storageBucket:     "physio-suai.firebasestorage.app",
      messagingSenderId: "316528709010",
      appId:             "1:316528709010:web:07fd170c8c2efeae67454b"
    };

    if (!firebase.apps.length) { firebase.initializeApp(FIREBASE_CONFIG); }

    // ✅ Use var (not const/let) so these are truly global window properties
    var auth = firebase.auth();
    var db   = firebase.database();

    // ── Supabase (storage only) ──────────────────────────────────
    var SUPABASE_URL  = "https://cnljatyxdqphdrcdmdph.supabase.co";
    var SUPABASE_KEY  = "sb_publishable_LVgOxezqX3kYpXqOEIeB8g_GzFB6WpR";
    var supabase      = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    var currentUser = null;
    auth.onAuthStateChanged(function(user) {
      if (user) {
        currentUser = user;
      }
    });

    // ── UI helpers ───────────────────────────────────────────────
    function spin(msg)     { document.getElementById('spinMsg').textContent = msg || 'Please wait…'; document.getElementById('spinner').classList.remove('hidden'); }
    function stopSpin()    { document.getElementById('spinner').classList.add('hidden'); }
    function showErr(id, msg) { var el=document.getElementById(id); el.textContent=msg; el.classList.remove('hidden'); }
    function hideErr(id)      { document.getElementById(id).classList.add('hidden'); }
    function showLogin()   { document.getElementById('signupBox').classList.add('hidden');  document.getElementById('loginBox').classList.remove('hidden'); }
    function showSignup()  { document.getElementById('loginBox').classList.add('hidden');   document.getElementById('signupBox').classList.remove('hidden'); }

    // ── Intro fade ───────────────────────────────────────────────
    setTimeout(function() {
      var intro = document.getElementById('intro');
      intro.style.cssText = 'opacity:0;transition:opacity 1s;pointer-events:none';
      setTimeout(function() {
        intro.classList.add('hidden');
        document.getElementById('loginBox').classList.remove('hidden');
      }, 1000);
    }, 2800);

    // ── LOGIN ────────────────────────────────────────────────────
    function doLogin() {
      hideErr('loginErr');
      var email = document.getElementById('lEmail').value.trim();
      var pass  = document.getElementById('lPass').value;
      if (!email || !pass) { showErr('loginErr','Please fill in all fields.'); return; }

      spin('Logging in…');
      auth.signInWithEmailAndPassword(email, pass)
        .then(function() {
          stopSpin();
          window.location.href = 'home.html';
        })
        .catch(function(err) {
          stopSpin();
          showErr('loginErr', err.message);
        });
    }

    // Allow pressing Enter to login
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        if (!document.getElementById('loginBox').classList.contains('hidden'))  doLogin();
        if (!document.getElementById('signupBox').classList.contains('hidden')) doSignup();
      }
    });

    // ── SIGNUP ───────────────────────────────────────────────────
    function doSignup() {
      hideErr('signupErr');
      var name  = document.getElementById('sName').value.trim();
      var email = document.getElementById('sEmail').value.trim();
      var pass  = document.getElementById('sPass').value;
      var pass2 = document.getElementById('sPass2').value;

      if (!name || !email || !pass || !pass2) { showErr('signupErr','Please fill in all fields.'); return; }
      if (pass !== pass2)                      { showErr('signupErr','Passwords do not match!');   return; }
      if (pass.length < 6)                     { showErr('signupErr','Password must be 6+ characters.'); return; }

      spin('Creating account…');
      auth.createUserWithEmailAndPassword(email, pass)
        .then(function(cred) {
          return db.ref('users/' + cred.user.uid).set({
            name: name,
            email: email,
            bio: 'Physio SUAI Member',
            photoURL: null,
            joinedAt: Date.now()
          });
        })
        .then(function() {
          stopSpin();
          showLogin();
          // Show success banner
          var banner = document.createElement('div');
          banner.className = 'fixed top-4 left-1/2 -translate-x-1/2 z-[9999] bg-green-500 text-white font-semibold px-6 py-3 rounded-xl shadow-xl';
          banner.textContent = '✅ Account created! Please login.';
          document.body.appendChild(banner);
          setTimeout(function(){ banner.remove(); }, 3000);
        })
        .catch(function(err) {
          stopSpin();
          showErr('signupErr', err.message);
        });
    }
  </script>
</body>
</html>
